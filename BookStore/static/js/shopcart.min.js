$((function(){var uname=sessionStorage.getItem("uname");function getSum(){var count=0,total=0;$(".txt").each((function(i,ele){count+=parseInt($(ele).val())})),$(".totalcount").html(count),$(".sum").each((function(i,ele){var totalprice=$(ele).html().substr(1,5);total+=parseFloat(totalprice)})),$(".total").html("￥"+total.toFixed(2)+"元")}function deleteShop(id,name){$.ajax({type:"post",url:"http://29759g4o70.imdo.co:14533/v1/shop/DeleteShop",contentType:"application/json;charset=utf-8",data:JSON.stringify({shop_id:parseInt(id),user_name:name}),dataType:"json",success:function(resp){window.location.reload()},error:function(resp){}})}$(".welcome").html("欢迎"+uname),$(".selectall").change((function(){var flag=$(this).prop("checked");$(".select,.selectall").prop("checked",flag)})),$(".tbd").on("change",".select",(function(){$(".select:checked").length==$(".select").length?$(".selectall").prop("checked",!0):$(".selectall").prop("checked",!1)})),getSum(),$.ajax({type:"post",url:"http://29759g4o70.imdo.co:14533/v1/shop/ShowUserCart",contentType:"application/json;charset=utf-8",data:JSON.stringify({user_name:uname}),dataType:"json",success:function(resp){if("nothing"==resp)$(".tip").css("display","block"),$(".tip").html("亲~您没有购买任何商品哦！");else{for(var html=[],i=0;i<resp.items.length;i++)html.push(` <div class="row shop-count">\n                <div class="col-md-1">\n                    <input type="checkbox" class="select" data-ipt="${resp.items[i].id}">\n                </div>\n                <div class="col-md-3 shop-info">\n                    <div class="media">\n                        <div class="media-left">\n                            <img src="${resp.items[i].img_path}" alt="" class="media-object">\n                        </div>\n                        <div class="media-body ">\n                            <p>${resp.items[i].shop_name}</p>\n                        </div>\n                    </div>\n                </div>\n                <div class="col-md-2 shop-price">￥${resp.items[i].shop_price}</div>\n                <div class="col-md-2 count">\n                    <button class="add">+</button><input type="text" value="${resp.items[i].shop_count}" class="txt"><button\n                        class="reduce">-</button>\n                </div>\n                <div class="col-md-2 shop-sum-price">\n                    <span class="sum">￥${resp.items[i].shop_amount}</span>\n                </div>\n                <div class="col-md-2">\n                    <a href="javascript:;" class="shop-id" data-id="${resp.items[i].id}">删除</a>\n                </div>\n            </div>`);$(".tbd").html(html.join("")),getSum()}},error:function(resp){}}),$(".tbd").on("click",".add",(function(){var num=$(this).siblings(".txt").val();num++,$(this).siblings(".txt").val(num);var p=$(this).parent().siblings(".shop-price").html();p=p.substr(1),$(this).parent().siblings(".shop-sum-price").children(".sum").html("￥"+(p*num).toFixed(2)),getSum()})),$(".tbd").on("click",".reduce",(function(){var num=$(this).siblings(".txt").val();if(1==num)return!1;num--,$(this).siblings(".txt").val(num);var p=$(this).parent().siblings(".shop-price").html();p=p.substr(1),$(this).parent().siblings(".shop-sum-price").children(".sum").html("￥"+(p*num).toFixed(2)),getSum()})),$(".tbd").on("change",".txt",(function(){var num=$(this).val(),p=$(this).parent().siblings(".shop-price").html();p=p.substr(1),$(this).parent().siblings(".shop-sum-price").children(".sum").html("￥"+(p*num).toFixed(2)),getSum()})),$(".tbd").on("click",".shop-id",(function(){var flag=confirm("亲~你确定要删除该商品嘛？"),id=$(this).attr("data-id");flag&&deleteShop(id,uname)})),$(".del").click((function(){var status=0,arr=[];if($(".select").each((function(index,ele){if($(ele).prop("checked")){var id=$(this).attr("data-ipt");arr.push(id),status=1}})),status){if(confirm("您确定要删除选中的商品嘛？"))for(var i=0;i<arr.length;i++)deleteShop(arr[i],uname)}else alert("没有选中任何商品")})),$(".empty").click((function(){var con;confirm("确定要清空购物车吗?")&&$.ajax({type:"post",url:"http://29759g4o70.imdo.co:14533/v1/shop/DeleteCart",contentType:"application/json;charset=utf-8",data:JSON.stringify({user_name:uname}),dataType:"json",success:function(resp){window.location.reload()},error:function(resp){}})})),$(".checkout").click((function(){$.ajax({type:"post",url:"http://29759g4o70.imdo.co:14533/v1/order/CreateOrder",contentType:"application/json;charset=utf-8",data:JSON.stringify({user_name:uname}),dataType:"json",success:function(resp){window.location.reload()},error:function(resp){}})}))}));
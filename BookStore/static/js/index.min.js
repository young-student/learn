$((function(){function getUname(){var uname=sessionStorage.getItem("uname");null!=uname?($(".login").css("display","none"),$(".register").css("display","none"),$(".cart").css("display","none"),$(".welcome").find("a").html("欢迎"+uname),$(".welcome").css("display","block"),$(".mycart").css("display","block"),$(".myorder").css("display","block"),$(".logout").css("display","block")):($(".welcome").css("display","none"),$(".mycart").css("display","none"),$(".myorder").css("display","none"),$(".logout").css("display","none"))}getUname();var laypage=layui.laypage;function init(pi,ps){$.ajax({type:"post",url:"http://29759g4o70.imdo.co:14533/v1/book/ShowBookShop",contentType:"application/json;charset=utf-8",data:JSON.stringify({pi:pi,ps:ps}),dataType:"json",success:function(resp){for(var html=[],i=0;i<resp.items.length;i++)html.push(`<li>\n                            <img src="${resp.items[i].img_path}" alt="">\n                            <p>书名:<span>${resp.items[i].title}</span></p>\n                            <p>作者:<span>${resp.items[i].author}</span></p>\n                            <p>价格:<span class="price">￥${resp.items[i].price}</span></p>\n                            <p>销量:<span>${resp.items[i].sales}</span></p>\n                            <p>库存:<span>${resp.items[i].stock}</span></p>\n                            <a href="javascript:;" onclick="buy(${resp.items[i].id})">加入购物车</a>\n                        </li>`);$("#book").html(html.join("")),laypage.render({elem:"page",count:resp.count,curr:pi,limit:ps,layout:["prev","page","next","count"],jump:function(obj,first){first||init(obj.curr,obj.limit)}})},error:function(resp){}})}init(1,4),$("#logsub").click((function(){var username=$("#u").val(),password=$("#p").val();if(""==username){if($(".tip").html("<i></i>用户名不能为空"),$(".tip").css("visibility","visible"),"visible"==$(".tip").css("visibility"))var num=3,timer=setInterval((function(){0==num&&($(".tip").css("visibility","hidden"),clearInterval(timer)),num--}),1e3);return!1}if(""==password){if($(".tip").html("<i></i>密码不能为空"),$(".tip").css("visibility","visible"),"visible"==$(".tip").css("visibility"))var num=3,timer=setInterval((function(){0==num&&($(".tip").css("visibility","hidden"),clearInterval(timer)),num--}),1e3);return!1}$.ajax({type:"post",url:"http://29759g4o70.imdo.co:14533/v1/login/user",contentType:"application/json;charset=utf-8",data:JSON.stringify({username:username,password:password}),dataType:"json",success:function(resp){"用户名或密码错误"==resp?alert(resp):(sessionStorage.setItem("uname",resp),$(".login-box").css("display","none"),$(".bg").css("display","none"),getUname())},error:function(resp){}})})),$("#regsub").click((function(){var username=$("#username").val(),email=$("#email").val(),password=$("#password").val(),confirm=$("#confirm").val();if(""==username||""==email||""==password||""==confirm)return alert("请按要求注册信息"),!1;$.ajax({type:"post",url:"http://29759g4o70.imdo.co:14533/v1/register/user",contentType:"application/json;charset=utf-8",data:JSON.stringify({username:username,email:email,password:password}),dataType:"json",success:function(resp){alert(resp),"注册成功"==resp&&($(".register-box").css("display","none"),$(".bg").css("display","none"),$(".login-box").css("display","block"),$(".bg").css("display","block"))},error:function(resp){}})})),$(".logout").click((function(){sessionStorage.clear(),window.location.reload()}))}));